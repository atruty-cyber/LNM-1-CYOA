<!DOCTYPE html>
<html lang="la">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Puella et Lupa ‚Äî Fabula Interactiva</title>
  <style>
    :root { --bg:#0f172a; --panel:#111827; --card:#1f2937; --text:#e5e7eb; --muted:#94a3b8; --accent:#22c55e; --danger:#ef4444; }
    *{box-sizing:border-box}
    body{margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: radial-gradient(1200px 600px at 20% 0%, #111827 0%, #0b1224 40%, #060a17 100%); color:var(--text);}
    .wrap{max-width:880px;margin:40px auto;padding:24px}
    .game{background:linear-gradient(180deg,#141b2c, #0f172a); border:1px solid #263042; border-radius:18px; padding:28px; box-shadow:0 10px 30px rgba(0,0,0,.45)}
    h1{margin:0 0 6px;font-size:clamp(24px,4vw,38px); letter-spacing:.5px}
    .subtitle{color:var(--muted); margin-bottom:18px}
    .screen{display:grid; grid-template-columns: 160px 1fr; gap:18px; align-items:start}
    pre.art{background:#0b1325; border:1px solid #23304b; color:#c7d2fe; padding:14px; border-radius:12px; margin:0; overflow:auto; line-height:1.15}
    .text{background:#0b1325; border:1px solid #23304b; padding:16px; border-radius:12px; line-height:1.6}
    .text em{color:#a5b4fc; font-style:normal}
    .choices{display:flex; gap:12px; margin-top:16px; align-items:center}
    .pager{display:flex; align-items:center; gap:10px}
    button.pager{appearance:none; border:none; padding:8px 10px; border-radius:10px; background:#1c2736; color:var(--text); cursor:pointer; border:1px solid #263044}
    button.pager:disabled{opacity:.35; cursor:default}
    .choice-main{flex:1; display:flex; flex-direction:column; gap:8px; align-items:stretch}
    button.choose{appearance:none; border:none; padding:14px; border-radius:12px; background:#10303b; color:var(--text); cursor:pointer; border:1px solid #21423a; font-weight:700; font-size:16px}
    button.choose:hover{transform:translateY(-2px)}
    .choice-label{background:#0b1325; border:1px solid #23304b; padding:10px; border-radius:10px; color:var(--muted); min-height:48px; display:flex; align-items:center}
    .footer{display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:18px; color:var(--muted); font-size:14px}
    .kbd{border:1px solid #2d3a4e; background:#0b1324; padding:2px 6px; border-radius:6px; color:#cbd5e1}
    .tag{display:inline-flex; align-items:center; gap:6px; font-size:12px; padding:6px 8px; background:#0b1325; border:1px solid #23304b; border-radius:999px}
    .status{font-weight:600}
    .status.victory{color:var(--accent)}
    .status.defeat{color:var(--danger)}
    .restart{margin-left:auto; appearance:none; border:none; padding:8px 12px; border-radius:10px; background:#16202a; color:var(--text); border:1px solid #27323b}
    @media (max-width:640px){ .screen{grid-template-columns:1fr} pre.art{order:2} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="game" role="application" aria-label="Fabula Interactiva Latina">
      <h1>Puella et Lupa</h1>
      <div class="subtitle">Fabula interactivƒÅ cum glossis ‚Äî <span class="tag">lingua: LatinƒÅ (glossae in <em>parenthesibus</em>)</span></div>

      <div id="screen" class="screen" aria-live="polite"></div>

      <div id="choices" class="choices" aria-hidden="false"></div>

      <div class="footer">
        <div>
          <span class="tag">Use <span class="kbd">‚Üê</span>/<span class="kbd">‚Üí</span> ad flip (paginas)</span>
          <span class="tag">Choose: <span class="kbd">Enter</span></span>
          <span class="tag">Restart: <span class="kbd">R</span></span>
        </div>
        <button id="restart" class="restart" title="Iterum ludere?">‚Üª Iterum</button>
      </div>
    </div>
  </div>

  <script>
    // ASCII art
    const art = {
      puella: "  (‚Ä¢‚Äø‚Ä¢)\\n /|   |\\\\\\n  |   |\\n  /   \\\\\\n",
      aqua: "    ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~\\n   ~       ~      ~       ~\\n    ~   ~     ~      ~   ~\\n",
      lupa: "   /^ ^\\\\\\n  / 0 0 \\\\\\n  V\\\\\\u005c\\/V\\n   / - \\\\\\n   |    \\\\\\n   || (__V\\n",
      agricola: "  (:=)  //  üë©\\u200düåæ\\n",
      poeta: "  ‚úç(‚óî‚Äø‚óî)\\n",
      athleta: "   ( )\\n  -| |-   üèãÔ∏è\\n   / \\\\\\\n",
      nauta: "     ‚õµ\\n",
      defeat: "   (√ó_√ó)\\n",
      victory: "  \\\\(^_^)/\\n"
    };

    // Scenes (same structure as before)
    const SCENES = {
      start: {
        title: 'Initium', art: 'puella', status: null,
        text: 'Puella est in terra (land). Puella ambulat per silvam (forest). Subito aqua est prope et vox auditur (is heard).',
        choices: [
          { label: 'Puella ad aquam ambulat', next: 'aqua', tone: 'primary' },
          { label: 'Puella ad vocem ambulat', next: 'lupa', tone: 'danger' }
        ]
      },
      aqua: {
        title: 'Aqua', art: 'aqua',
        text: 'Aqua est magna et clara (<em>bright</em>). Femina est ibi et aquam portat.',
        choices: [
          { label: 'Puella amat aquam et manet', next: 'def_bibit', tone: 'danger' },
          { label: 'Puella sequitur feminam', next: 'field', tone: 'primary' }
        ]
      },
      lupa: {
        title: 'Lupa', art: 'lupa',
        text: 'Puella ambulat ad vocem. Lupa est magna et mala (<em>evil</em>).',
        choices: [
          { label: 'Puella fugit', next: 'def_fugit', tone: 'danger' },
          { label: 'Puella stat et amat lupam', next: 'def_amat_lupam', tone: 'danger' }
        ]
      },
      field: {
        title: 'Terra', art: 'agricola',
        text: 'Femina ducit puellam ad agricolam (<em>farmer</em>). Agricola curat terram et dicit: "Nauta est in mari (sea). Poeta est in villƒÅ (house)."',
        choices: [
          { label: 'Puella sequitur agricolam', next: 'def_laborat', tone: 'danger' },
          { label: 'Puella petit poetam', next: 'poet', tone: 'primary' }
        ]
      },
      poet: {
        title: 'Poeta', art: 'poeta',
        text: 'Poeta dicit: "Amor est fortis. Athleta in urbe (<em>city</em>) te adiuvat (helps)."',
        choices: [
          { label: 'Puella sequitur poetam', next: 'athlete', tone: 'primary' },
          { label: 'Puella amat poetam', next: 'def_poeta', tone: 'danger' }
        ]
      },
      athlete: {
        title: 'Athleta', art: 'athleta',
        text: 'Athleta dicit: "Nauta amat libertatem (<em>freedom</em>). Si puella nautae credit (trusts), victoria est."',
        choices: [
          { label: 'Puella sequitur athletam ad nautam', next: 'sailor', tone: 'primary' },
          { label: 'Puella manet in urbe', next: 'def_urbs', tone: 'danger' }
        ]
      },
      sailor: {
        title: 'Nauta', art: 'nauta',
        text: 'Nauta amat mare et dicit: "Puella, si amas terram et aquam et vitam, mecum naviga!"',
        choices: [
          { label: 'Puella navigat cum nauta', next: 'victory', tone: 'primary' },
          { label: 'Puella manet in terra', next: 'def_lupa_revenit', tone: 'danger' }
        ]
      },

      // ‚Äî Defeats
      def_bibit: { title: 'Perdit', art: 'defeat', status: 'defeat', text: 'Puella bibit nimiam aquam. Non ambulat. <strong>Perdit.</strong>', choices: [{ label: 'Iterum ludere', next: 'start', tone: 'primary' }] },
      def_fugit: { title: 'Perdit', art: 'defeat', status: 'defeat', text: 'Puella currit, sed lupa celerior est. <strong>Perdit.</strong>', choices: [{ label: 'Iterum ludere', next: 'start', tone: 'primary' }] },
      def_amat_lupam: { title: 'Perdit', art: 'defeat', status: 'defeat', text: 'Puella amat lupam. Lupa edit (<em>eats</em>) puellam. <strong>Perdit.</strong>', choices: [{ label: 'Iterum ludere', next: 'start', tone: 'primary' }] },
      def_laborat: { title: 'Perdit', art: 'defeat', status: 'defeat', text: 'Puella laborat in terrƒÅ semper. Non est libera (<em>free</em>). <strong>Perdit.</strong>', choices: [{ label: 'Iterum ludere', next: 'start', tone: 'primary' }] },
      def_poeta: { title: 'Perdit', art: 'defeat', status: 'defeat', text: 'Poeta amat fƒ´liam suam, non puellam. <strong>Perdit.</strong>', choices: [{ label: 'Iterum ludere', next: 'start', tone: 'primary' }] },
      def_urbs: { title: 'Perdit', art: 'defeat', status: 'defeat', text: 'Urbs est pulchra sed periculosa (<em>dangerous</em>). <strong>Perdit.</strong>', choices: [{ label: 'Iterum ludere', next: 'start', tone: 'primary' }] },
      def_lupa_revenit: { title: 'Perdit', art: 'defeat', status: 'defeat', text: 'Puella manet in terrƒÅ. Lupa iterum venit. <strong>Perdit.</strong>', choices: [{ label: 'Iterum ludere', next: 'start', tone: 'primary' }] },

      // ‚Äî Victory
      victory: { title: 'Victoria!', art: 'victory', status: 'victory', text: 'Puella et nauta in aquƒÅ sunt. Vita est bona. Amant vitam. <strong>VICTORIA!</strong>', choices: [{ label: 'Iterum ludere', next: 'start', tone: 'primary' }] }
    };

    const elScreen = document.getElementById('screen');
    const elChoices = document.getElementById('choices');
    const elRestart = document.getElementById('restart');

    let currentScene = 'start';
    let choiceIndex = 0; // which choice page is visible

    function buildChoicePager(scene) {
      // scene.choices is an array; we display exactly one at a time with Prev/Next + Choose
      elChoices.innerHTML = '';

      const pager = document.createElement('div');
      pager.className = 'pager';

      // Prev button
      const btnPrev = document.createElement('button');
      btnPrev.className = 'pager';
      btnPrev.textContent = '‚óÄ';
      btnPrev.title = 'Praeteri (previous)';
      btnPrev.disabled = (choiceIndex <= 0);
      btnPrev.addEventListener('click', () => {
        if(choiceIndex > 0) {
          choiceIndex -= 1;
          updateChoiceView(scene);
        }
      });

      // Next button
      const btnNext = document.createElement('button');
      btnNext.className = 'pager';
      btnNext.textContent = '‚ñ∂';
      btnNext.title = 'Proximus (next)';
      btnNext.disabled = (choiceIndex >= scene.choices.length - 1);
      btnNext.addEventListener('click', () => {
        if(choiceIndex < scene.choices.length - 1) {
          choiceIndex += 1;
          updateChoiceView(scene);
        }
      });

      // Choice main area
      const main = document.createElement('div');
      main.className = 'choice-main';

      const label = document.createElement('div');
      label.className = 'choice-label';
      label.setAttribute('aria-live', 'polite');

      const pageInfo = document.createElement('div');
      pageInfo.style.fontSize = '12px';
      pageInfo.style.color = 'var(--muted)';

      const chooseBtn = document.createElement('button');
      chooseBtn.className = 'choose';
      chooseBtn.textContent = 'Elige';
      chooseBtn.addEventListener('click', () => {
        const chosen = scene.choices[choiceIndex];
        if (chosen) render(chosen.next);
      });

      main.appendChild(label);
      main.appendChild(pageInfo);
      main.appendChild(chooseBtn);

      pager.appendChild(btnPrev);
      pager.appendChild(main);
      pager.appendChild(btnNext);

      elChoices.appendChild(pager);

      // store references for update
      elChoices._btnPrev = btnPrev;
      elChoices._btnNext = btnNext;
      elChoices._label = label;
      elChoices._pageInfo = pageInfo;
      elChoices._chooseBtn = chooseBtn;

      updateChoiceView(scene);
    }

    function updateChoiceView(scene) {
      // Ensure choiceIndex is valid
      if (choiceIndex < 0) choiceIndex = 0;
      if (choiceIndex >= scene.choices.length) choiceIndex = scene.choices.length - 1;

      const c = scene.choices[choiceIndex];
      elChoices._label.innerHTML = `<strong>${c.label}</strong>`;
      elChoices._pageInfo.textContent = `Pagina ${choiceIndex + 1} / ${scene.choices.length}`;
      elChoices._btnPrev.disabled = (choiceIndex <= 0);
      elChoices._btnNext.disabled = (choiceIndex >= scene.choices.length - 1);
      // Update Choose button appearance based on tone
      elChoices._chooseBtn.className = 'choose';
      if (c.tone === 'danger') elChoices._chooseBtn.style.background = '#3a1518';
      else elChoices._chooseBtn.style.background = '#10303b';
      elChoices._chooseBtn.focus();
    }

    function render(id) {
      const s = SCENES[id] || SCENES.start;
      currentScene = id;
      choiceIndex = 0; // reset pager to first choice on each scene

      elScreen.innerHTML = `
        <pre class="art" aria-hidden="true">${(art[s.art] || '')}</pre>
        <div class="text">
          <div class="status ${s.status || ''}">${s.status === 'victory' ? 'Victoria!' : s.status === 'defeat' ? 'Perdit' : ''}</div>
          <h2 style="margin:6px 0 8px;font-size:20px;">${s.title}</h2>
          <p>${s.text}</p>
        </div>`;

      buildChoicePager(s);

      // Show/hide restart button based on whether we're in an end-state
      elRestart.style.visibility = (s.status ? 'visible' : 'hidden');
    }

    // Keyboard handling
    window.addEventListener('keydown', (e) => {
      const s = SCENES[currentScene];
      if (!s) return;

      // Left / Right flip
      if (e.key === 'ArrowLeft') {
        if (choiceIndex > 0) { choiceIndex -= 1; updateChoiceView(s); }
      } else if (e.key === 'ArrowRight') {
        if (choiceIndex < s.choices.length - 1) { choiceIndex += 1; updateChoiceView(s); }
      } else if (e.key === 'Enter') {
        // choose current
        const chosen = s.choices[choiceIndex];
        if (chosen) render(chosen.next);
      } else if (e.key.toLowerCase() === 'r') {
        render('start');
      }
    });

    elRestart.addEventListener('click', () => render('start'));

    // Start
    render('start');
  </script>
</body>
</html>
